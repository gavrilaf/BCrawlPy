<!DOCTYPE HTML>
<html lang="en">
  
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bootstrap.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='bootstrap-responsive.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='common.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='monitor.css') }}">

    <script src="{{ url_for('static', filename='jquery.js') }}"></script>
    <script>
      $(document).ready(function(){
        function updateMonitor() {
          $.ajax({
            url: 'http://127.0.0.1:5000/api/v1.0/cmon',
            success: function(r) {
              $('#query-sent-hour').text(r.monitor.queries.sent.hour)
              $('#query-sent-day').text(r.monitor.queries.sent.day)
              $('#query-sent-all').text(r.monitor.queries.sent.all)
              $('#query-completed-hour').text(r.monitor.queries.completed.hour)
              $('#query-completed-day').text(r.monitor.queries.completed.day)
              $('#query-completed-all').text(r.monitor.queries.completed.all)

              $('#ya-search-sent-day').text(r.monitor.http.search.yandex.sent.hour)
              $('#ya-search-sent-hour').text(r.monitor.http.search.yandex.sent.day)
              $('#ya-search-error-day').text(r.monitor.http.search.yandex.error.hour)
              $('#ya-search-error-hour').text(r.monitor.http.search.yandex.error.day)

              $('#ya-content-sent-day').text(r.monitor.http.content.yandex.sent.hour)
              $('#ya-content-sent-hour').text(r.monitor.http.content.yandex.sent.day)
              $('#ya-content-error-day').text(r.monitor.http.content.yandex.error.hour)
              $('#ya-content-error-hour').text(r.monitor.http.content.yandex.error.day)

              $('#lj-content-sent-day').text(r.monitor.http.content.lj.sent.hour)
              $('#lj-content-sent-hour').text(r.monitor.http.content.lj.sent.day)
              $('#lj-content-error-day').text(r.monitor.http.content.lj.error.hour)
              $('#lj-content-error-hour').text(r.monitor.http.content.lj.error.day)

              $('#vk-content-sent-day').text(r.monitor.http.content.vk.sent.hour)
              $('#vk-content-sent-hour').text(r.monitor.http.content.vk.sent.day)
              $('#vk-content-error-day').text(r.monitor.http.content.vk.error.hour)
              $('#vk-content-error-hour').text(r.monitor.http.content.vk.error.day)

              $('#post-collected-hour').text(r.monitor.post.collected.hour)
              $('#post-collected-day').text(r.monitor.post.collected.day)
              $('#post-collected-all').text(r.monitor.post.collected.all)
            }
          });
        } 
        window.updateInterval = setInterval(updateMonitor, 5000);
      })
    </script>
    <title>Monitor</title>
  </head>
  
   
  <body>
    <div id="page-wrapper">
      <div id="absolute-wrapper">
          <div class="page-header big-line">
            <h1>BlCrawl Monitor</h1>
          </div>        
        <div>
          <h2 class="heading">Запросы</h2>
          <table class="bordered table table-striped table-bordered table-condensed">
            <thead>
              <tr>        
                <th />
                <th>Час</th>
                <th>Сутки</th>
                <th>Всего</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-bold">Отправлено</td>
                <td id="query-sent-hour">N/A</td>
                <td id="query-sent-day">N/A</td>
                <td id="query-sent-all">N/A</td>
              </tr>
              <tr>
                <td class="text-bold">Собрано</td>
                <td id="query-completed-hour">N/A</td>
                <td id="query-completed-day">N/A</td>
                <td id="query-completed-all">N/A</td>
              </tr>
              <tr>
                <td class="text-bold text-red">Ошибки</td>
                <td id="query-error-hour" class="text-red">N/A</td>
                <td id="query-error-days" class="text-red">N/A</td>
                <td id="query-error-all" class="text-red">N/A</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div>
          <h2 class="heading">Http requests</h2>
          <div class="container">
            <div class="row-fluid">
              <span class="span-column">
                <table class="table table-striped table-bordered table-condensed bordered">
                  <thead>
                    <tr>
                      <th>Yandex поиск</th>
                      <th>День</th>
                      <th>Час</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="text-bold">Отправлено</td>
                      <td id="ya-search-sent-day">N/A</td>
                      <td id="ya-search-sent-hour">N/A</td>
                    </tr>
                    <tr>
                      <td class="text-bold text-red">Ошибки</td>
                      <td id="ya-search-error-day" class="text-red">N/A</td>
                      <td id="ya-search-error-hour" class="text-red">N/A</td>
                    </tr>
                  </tbody>
                </table>
              </span>
              <span class="span-column">
                <table class="table table-striped table-bordered table-condensed bordered">
                  <thead>
                    <tr>
                      <th>Yandex контент</th>
                      <th>День</th>
                      <th>Час</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="text-bold">Отправлено</td>
                      <td id="ya-content-sent-day">N/A</td>
                      <td id="ya-content-sent-hour">N/A</td>
                    </tr>
                    <tr>
                      <td class="text-bold text-red">Ошибки</td>
                      <td id="ya-content-error-day" class="text-red">N/A</td>
                      <td id="ya-content-error-hour" class="text-red">N/A</td>
                    </tr>
                  </tbody>
                </table>
              </span>
            </div>
          </div>
          <div class="container">
            <div class="row-fluid">
              <span class="span-column">
                <table class="table table-striped table-bordered table-condensed bordered">
                  <thead>
                    <tr>
                      <th>LJ контент</th>
                      <th>День</th>
                      <th>Час</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="text-bold">Отправлено</td>
                      <td id="lj-content-sent-day">N/A</td>
                      <td id="lj-content-sent-hour">N/A</td>
                    </tr>
                    <tr>
                      <td class="text-bold text-red">Ошибки</td>
                      <td id="lj-content-error-day" class="text-red">N/A</td>
                      <td id="lj-content-error-hour" class="text-red">N/A</td>
                    </tr>
                  </tbody>
                </table>
              </span>
              <span class="span-column">
                <table class="table table-striped table-bordered table-condensed bordered">
                  <thead>
                    <tr>
                      <th>VK контент</th>
                      <th>День</th>
                      <th>Час</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="text-bold">Отправлено</td>
                      <td id="vk-content-sent-day">N/A</td>
                      <td id="vk-content-sent-hour">N/A</td>
                    </tr>
                    <tr>
                      <td class="text-bold text-red">Ошибки</td>
                      <td id="vk-content-error-day" class="text-red">N/A</td>
                      <td id="vk-content-error-hour" class="text-red">N/A</td>
                    </tr>
                  </tbody>
                </table>
              </span>
            </div>
          </div>
        </div>
        <div>
          <h2 class="heading">Обработка постов</h2>
          <table class="table table-striped table-bordered table-condensed bordered">
            <thead>
              <tr>
                <th />
                <th>Час</th>
                <th>Сутки</th>
                <th>Всего</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-bold">Собрано</td>
                <td id="post-collected-hour">N/A</td>
                <td id="post-collected-day">N/A</td>
                <td id="post-collected-all">N/A</td>
              </tr>
              <tr>
                <td class="text-bold">Дубликаты</td>
                <td id="post-dublicate-hour">N/A</td>
                <td id="post-dublicate-day">N/A</td>
                <td id="post-dublicate-all">N/A</td>
              </tr>
              <tr>
                <td class="text-bold">Обновления</td>
                <td id="post-update-hour">N/A</td>
                <td id="post-update-day">N/A</td>
                <td id="post-update-all">N/A</td>
              </tr>
              <tr>
                <td class="text-bold">Новый запрос</td>
                <td id="post-new-link-hour">N/A</td>
                <td id="post-new-link-day">N/A</td>
                <td id="post-new-link-all">N/A</td>
              </tr>
              <tr>
                <td class="text-bold">Спам</td>
                <td id="post-spam-hour">N/A</td>
                <td id="post-spam-day">N/A</td>
                <td id="post-spam-all">N/A</td>
              </tr>
              <tr>
                <td class="text-bold">Сохранено</td>
                <td id="post-persisted-hour">N/A</td>
                <td id="post-persisted-day">N/A</td>
                <td id="post-persisted-all">N/A</td>
              </tr>
              <tr>
                <td class="text-bold text-red">Ошибки</td>
                <td class="text-red" id="post-error-hour">N/A</td>
                <td class="text-red" id="post-error-day">N/A</td>
                <td class="text-red" id="post-error-all">N/A</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </body>

</html>